# 第九次作业
> <font face='楷体' size=4>22371437 <br>
> 张智威</font>

## 课本第305页
### 第3题
&ensp; &ensp; &ensp;如果先写了数据库修改，而在运行记录中没有登记这个修改，即先写了数据库然后发生故障，而仍未写日记文件，则以后就无法恢复这个修改了，因此必须先写日记文件，再写数据库。

### 第4题
* (1)：事务1,3需要重做，事务2,4需要回滚
* (2)：事务1需要重做，事务2,3需要回滚
* (3)：事务1需要重做，事务2,3需要回滚
* (4)：事务1需要重做，事务2需要回滚

### 第5题
* (1)：`A = 8`，`B = 7`，`C = 11`
* (2)：`A = 10`，`B = 0`，`C = 11`
* (3)：`A = 10`，`B = 0`，`C = 11`
* (4)：`A = 10`，`B = 0`，`C = 11`
* (5)：`A = 10`，`B = 0`，`C = 11`
* (6)：`A = 0`，`B = 0`，`C = 0`

### 第6题
* 事务故障的恢复：利用日志文件撤销此事务已对数据库进行的修改
  * 反向扫描日志文件，查找该事务的更新操作
  * 对该事务的更新操作执行逆操作，即将更新前的值写入数据库
  * 继续反向扫描日志文件，查找该事务其他更新操作，做同样处理
  * 如此处理下去，直到读到此事务开始标记，完成事务故障的恢复
* 系统故障的恢复：撤销故障发生时未完成的事务，重做已完成的事务
  * 正向扫描日志文件，找出故障发生前已经提交的事务，将其事务标识记入重做队列，同时找出故障发生时尚未完成的事务，将其事务标识记入撤销队列。
  * 对撤销队列中的各个事务进行撤销处理：反向扫描日志文件，对每个撤销事务的更新操作执行逆操作，即将更新前的值写入数据库
  * 对重做队列中的各个事务进行重做处理：正向扫描日志文件，对每个重做事务重新执行日志文件登记的操作，即将日志记录中更新后的值写入数据库。
* 介质故障的恢复：重装数据库，然后重做已完成的事务
  * 装入最新的数据库后备副本
  * 装入相应的日志文件副本，重做已完成的事务

### 第7题
* 检查点记录：一个重新开始文件，并让恢复子系统在登录日志文件期间动态的维护日志
* 内容：
  * 建立检查点时刻所有正在执行的事务清单
  * 这些事务最近一个日志记录的地址

### 第8题
* 优点：可以改善恢复效率
* 例子：当事务T在一个检查点之前提交，T对数据库所做的修改一定都已写入数据库，写入时间是在这个检查点建立之前或在这个检查点建立之时，在进行恢复处理时，没有必要对事务T进行重做操作

### 第9题
* 检查点方法恢复步骤：
  * 从重新开始文件中找到最后一个检查点记录在日志文件中的地址，由该地址在日志文件中找到最后一个检查点记录。
  * 由该检查点记录得到检查点建立时刻所有正在执行的事务清单`ACTIVE-LIST`,建立两个事务队列`UNDO-LIST`,`REDO-LIST`,将`ACTIVE-LIST`暂时放入`UNDO-LIST`，`REDO-LIST`为空
  * 从检查点开始正向扫描日志文件：
    * 如有新开始的事务T<sub>i</sub>，把T<sub>i</sub>暂时放入`UNDO-LIST`。
    * 如有提交的事务T<sub>j</sub>,把T<sub>i</sub>从`UNDO-LIST`移动到`RNDO-LIST`，直到日志文件结束。
    * 对`UNDO-LIST`每个事务执行UNDO操作，对`RNDO-LIST`每个事务执行REDO操作。